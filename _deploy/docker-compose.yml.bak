version: '3'
services:
  client-dev:
    build:
      context: .
      dockerfile: ./_deploy/client/dev.Dockerfile
    environment:
      NODE_ENV: production
    ports:
      - '90:3000'
    volumes:
        - /<PROJECT_NAME>/node_modules
        - .:/<PROJECT_NAME>
    restart: always # on-failure maybe used for a worker
  test:
    build:
      context: .
      dockerfile: client.prod.Dockerfile
    environment:
      NODE_ENV: production
    volumes:
        - /<PROJECT_NAME>/node_modules
        - .:/<PROJECT_NAME>
    command: ["npm", "run", "test:watch"]
  proxy:
    build: 
      context: .
      dockerfile: proxy.Dockerfile
    container_name: proxy
    ports:
      - '80:90'
      - '443:90'
    volumes:
      - ./_deploy/proxy/nginx.conf:/etc/nginx/conf.d/<PROJECT_NAME>.conf
      # - /etc/nginx/psw:/etc/nginx/psw
      # - /etc/nginx/ssl:/etc/nginx/ssl
    depends_on:
      - client
    restart: always
  # server:
  #     image: node:alpine
  #   # command:
  #   container_name: server
# volumes: #optional
# networks: #optional